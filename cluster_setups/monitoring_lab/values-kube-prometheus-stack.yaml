# values-kube-prometheus-stack.yaml
# Helm values for kube-prometheus-stack on kind

# -- Grafana configuration --
grafana:
  enabled: true
  adminUser: admin
  adminPassword: admin  # Change in production!

  service:
    type: NodePort
    nodePort: 30080

  # Provision default dashboards
  defaultDashboardsEnabled: true
  defaultDashboardsTimezone: utc

  sidecar:
    dashboards:
      enabled: true
      searchNamespace: ALL
    datasources:
      enabled: true

  # Resource limits for kind
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

# -- Prometheus configuration --
prometheus:
  prometheusSpec:
    # Scrape all ServiceMonitors across namespaces
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    ruleSelectorNilUsesHelmValues: false

    # Retention
    retention: 7d
    retentionSize: "5GB"

    # Storage - use emptyDir for kind (switch to PVC for production)
    storageSpec: {}
    #   volumeClaimTemplate:
    #     spec:
    #       accessModes: ["ReadWriteOnce"]
    #       resources:
    #         requests:
    #           storage: 10Gi

    # Resource limits for kind
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi

  service:
    type: NodePort
    nodePort: 30090

# -- Alertmanager configuration --
alertmanager:
  enabled: true
  alertmanagerSpec:
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi
  service:
    type: NodePort
    nodePort: 30093

# -- Node Exporter --
nodeExporter:
  enabled: true

# -- Kube State Metrics --
kubeStateMetrics:
  enabled: true

# -- Component scraping configs --
kubeApiServer:
  enabled: true

kubeControllerManager:
  enabled: true
  endpoints:
    - 172.18.0.2  # Will be auto-discovered, fallback

kubeScheduler:
  enabled: true

kubeProxy:
  enabled: true

kubeEtcd:
  enabled: true

# -- PrometheusRule for basic alerts --
defaultRules:
  create: true
  rules:
    alertmanager: true
    etcd: true
    configReloaders: true
    general: true
    k8s: true
    kubeApiserverAvailability: true
    kubeApiserverBurnrate: true
    kubeApiserverHistogram: true
    kubeApiserverSlos: true
    kubeControllerManager: true
    kubelet: true
    kubeProxy: true
    kubePrometheusGeneral: true
    kubePrometheusNodeRecording: true
    kubernetesApps: true
    kubernetesResources: true
    kubernetesStorage: true
    kubernetesSystem: true
    kubeSchedulerAlerting: true
    kubeSchedulerRecording: true
    kubeStateMetrics: true
    network: true
    node: true
    nodeExporterAlerting: true
    nodeExporterRecording: true
    prometheus: true
    prometheusOperator: true